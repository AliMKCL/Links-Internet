<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reddit Gaming Advisor</title>
    <link rel="stylesheet" href="/static/index.css">
</head>

<body>
    <div class="container">
        <h1>Reddit Gaming Advisor</h1>
        <input type="text" id="query" placeholder="Ask a gaming question..."
            style="width:100%;margin-bottom:1rem;padding:0.75rem;border-radius:8px;border:1px solid #43cea2;font-size:1.1rem;">
        <select id="metric"
            style="width:100%;margin-bottom:1rem;padding:0.75rem;border-radius:8px;border:1px solid #43cea2;font-size:1.1rem;">
            <option value="all">All Time</option>
            <option value="year">Last Year</option>
            <option value="month">Last Month</option>
        </select>
        <button onclick="submitQuery()">Submit</button>
        <div id="output"></div>
    </div>
    <script>
        async function submitQuery() {
            const query = document.getElementById('query').value;
            const metric = document.getElementById('metric').value;
            const outputDiv = document.getElementById('output');
            outputDiv.textContent = 'Loading...';
            try {
                const response = await fetch(`/query?q=${encodeURIComponent(query)}&metric=${encodeURIComponent(metric)}`);
                if (!response.ok) {
                    outputDiv.textContent = 'Error: ' + response.statusText;
                    return;
                }
                const data = await response.json();
                if (data.results && data.results.length > 0) {
                    outputDiv.innerHTML = data.results.map((r, idx) => {
                        const contentId = `post-content-${idx}`;
                        const commentsId = `post-comments-${idx}`;
                        const contentButtonId = `toggle-content-btn-${idx}`;
                        const commentsButtonId = `toggle-comments-btn-${idx}`;

                        const contentSection = r.content ? `<button id="${contentButtonId}" onclick="toggleContent('${contentId}', '${contentButtonId}')" class="content-button">See content</button>` : '';

                        const commentsSection = r.comments ? `<button id="${commentsButtonId}" onclick="toggleContent('${commentsId}', '${commentsButtonId}')" class="comments-button">See comments</button>` : '';

                        const contentDiv = r.content ? `<div id="${contentId}" class="content-section" style="display:none;">${r.content}</div>` : '';

                        const commentsDiv = r.comments ? `<div id="${commentsId}" class="comments-section" style="display:none;">${r.comments}</div>` : '';

                        const subredditSection = r.subreddit ? `<span style='color:#43cea2;font-weight:bold;'>r/${r.subreddit}</span><br>` : '';
                        return `<div class="post-item">${subredditSection}<a href="${r.url}" target="_blank" style="color:#185a9d;font-weight:bold;text-decoration:none;">${r.title}</a><br><div class="post-buttons-container"><div class="post-buttons">${contentSection}${commentsSection}</div></div>${contentDiv}${commentsDiv}<span>${r.summary}</span></div>`;
                    }).join('');

                    // Add toggleContent function
                    window.toggleContent = function (contentId, buttonId) {
                        const contentDiv = document.getElementById(contentId);
                        const button = document.getElementById(buttonId);
                        if (contentDiv.style.display === 'none') {
                            contentDiv.style.display = 'block';
                            if (buttonId.includes('content')) {
                                button.textContent = 'Hide content';
                            } else if (buttonId.includes('comments')) {
                                button.textContent = 'Hide comments';
                            }
                        } else {
                            contentDiv.style.display = 'none';
                            if (buttonId.includes('content')) {
                                button.textContent = 'See content';
                            } else if (buttonId.includes('comments')) {
                                button.textContent = 'See comments';
                            }
                        }
                    }
                } else {
                    outputDiv.textContent = 'No results found.';
                }
            } catch (e) {
                outputDiv.textContent = 'Error: ' + e;
            }
        }
    </script>
</body>

</html>